# キャッシング

<https://graphql.org/learn/caching/>

- [キャッシング](#キャッシング)
  - [グローバルに一意な識別子](#グローバルに一意な識別子)
  - [既存のAPIとの互換性](#既存のapiとの互換性)
  - [互換性](#互換性)

> クライアントが豪華なキャッシュを構築できるように、オブジェクトの識別子を提供してください。

エンドポイントに基づいたAPIにおいて、クライアントはリソースの再取得を容易に回避するためにHTTPキャッシングを使用でき、それは2つのリソースが同じときに識別します。
これらのAPIのURLは**グローバルに一意な識別子**で、クライアントはキャッシュを構築するときに活用できます。
しかし、GraphQLにおいて、与えられたオブジェクトのために、このグローバルに一意な識別を提供するURLのような構成要素はありません。
従って、APIのベストプラクティスは、クライアントが使用するそのような識別子を公開することです。

## グローバルに一意な識別子

このために可能な1つのパターンは、グローバルに一意な識別子になる`id`のようなフィールドの予約です。
次は、このドキュメントを通じて使用されたスキーマの例で、この手法を使用しています。

```graphql
{
  starship(id: "3003") {
    id
    name
  }
  droid(id: "2001") {
    id
    name
    friends {
      id
      name
    }
  }
}
```

```json
{
  "data": {
    "starship": {
      "id": "3003",
      "name": "Imperial shuttle"
    },
    "droid": {
      "id": "2001",
      "name": "R2-D2",
      "friends": [
        {
          "id": "1000",
          "name": "Luke Skywalker"
        },
        {
          "id": "1002",
          "name": "Han Solo"
        },
        {
          "id": "1003",
          "name": "Leia Organa"
        }
      ]
    }
  }
}
```

これはクライアントの開発者に渡せる強力なツールです。
グローバルに一意なキーを提供するリソースベースのAPIのURLと同様に、`id`フィールドはこのシステム内でグローバルに一意なキーを提供します。

バックエンドが識別子にUUIDのような何かを使用している場合、このグローバルに一意なIDを公開することはとても簡単です。
バックエンドが、まだすべてのオブジェクトのためにグローバルに一意なIDを持っていない場合、GraphQLレイヤでこれを構築する必要があるかもしれません。
多くの場合、これは、タイプの名前をIDに追加し、それを識別子として使用するだけでそれと同様に単純です。
その後、サーバーはそのIDをBASE64でエンコードすることで不透明にするかもしれません。

オプションで、このIDは[グローバルオブジェクトID](https://graphql.org/learn/global-object-identification/)の`node`パターンを機能っせるために使用されます。

## 既存のAPIとの互換性

この目的で`id`フィールドを使用する懸念事項の1つは、GraphQLのAPIを使用するクライアントが既存のAPIと機能させる方法です。
例えば、既存のAPIが型特有のIDを受け付ける場合、しかしGraphQLのAPIはグローバルに一意なIDを使用して、一度に両方を使用することはトリッキーになります。

この場合、分離したフィールドで以前のAPIのIDを公開することができます。
これは、両方の世界で最善を与えてくれます。

- GraphQLクライアントは、得られたグローバルに一意なIDを得ることで、一貫性のあるメカニズムに依存することを継続できます。
- 以前のAPIと機能する必要があるAPIも、オブジェクトから`previousApiId`を取得して、それを使用できます。

## 互換性

グローバルに一意なIDが過去についても強力なパターンであることが証明された一方で、それはそのパターンで使用できるだけでなく、すべての状況で正しいです。
クライアントが必要とする本当に重要な機能性は、それらのキャッシングのためにグローバルに一意なIDを導出するための能力です。
サーバーがそのIDを導出する機能を持つことは、クライアントを簡素化して、そのクライアントもまた識別子を導出できます。
時々、これは`__typename`でクエリすることで得られるオブジェクトの型と任意の型の一意な識別子を結合すると同じくらい単純です。

加えて、GraphQLで既存のAPIを置き換える場合、GraphQL内のすべてのフィールドが、グローバルに一位になるように変更された`id`を除いてすべて同じな場合、混乱する可能性があります。
これは、グローバルに一意なフィールドとして`id`を使用することを選択しなかった別の理由によるものです。
